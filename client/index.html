<!DOCTYPE html>
<html ng-app='myApp'> 
  <head>
    <title></title>
    <script src="angular/angular.js"></script>
    <script src="angular-route/angular-route.js"></script>
<script>
    var myApp = angular.module('myApp', ['ngRoute']);
    myApp.config(function ($routeProvider) {
      $routeProvider
        .when('/players',{
            templateUrl: 'partials/players.html'
        })
        .when('/teams',{
            templateUrl: 'partials/teams.html'
        })
        .when('/associations',{
            templateUrl: 'partials/associations.html'
        })
        .otherwise({
          redirectTo: '/'
        });
    });

    myApp.factory('playerFactory', function(){
      var players = [
        {name: 'Aname'},
        {name: 'Bname'},
        {name: 'Cname'}];
      var factory = {};
      factory.getPlayers = function(callback){
        callback(players.slice(0));
      }
      factory.addPlayer = function(newplayer, callback){
        players.push(newplayer);
        callback();
      }

      factory.removePlayer = function(index, callback){
        players.splice(index, 1);
        callback();
      }

      factory.assignTeam = function(index, team, callback){
        players[index].team = team;
        callback();
      }

      factory.clearAssignment = function(index, callback){
        players[index].team = '';
        callback();
      }


      factory.log = function(cb){
        console.log("Factory: ", players);
        cb(); 
      }

      return factory; 
    })

    myApp.factory('teamFactory', function(){
      var teams = [
        {name: 'Ateam'},
        {name: 'Bteam'},
        {name: 'Cteam'}];
      var factory = {};
      factory.getTeams = function(callback){
        callback(teams.slice(0));
      }
      factory.addTeam = function(newteam, callback){
        teams.push(newteam);
        callback();
      }

      factory.removeTeam = function(index, callback){
        teams.splice(index, 1);
        callback();
      }


      factory.log = function(cb){
        console.log("Factory: ", teams);
        cb(); 
      }

      return factory; 
    })

     

    myApp.controller('playersController', ['$scope', '$location', 'playerFactory', function ($scope, $location, playerFactory) {
      console.log("$location: ", $location);
      $scope.players = []; 
      $scope.newplayer = {
        name: ''
      };
      playerFactory.getPlayers(function(data){
        $scope.players = data; 
      }); 
      
      $scope.addplayer = function(){
        playerFactory.addPlayer($scope.newplayer, function(){
          $scope.players.push($scope.newplayer);
          // $location.url('/teams');
        })
      }

      $scope.removeplayer = function(index){
        playerFactory.removePlayer(index, function(){
          $scope.players.splice(index, 1);
        })
      }

      $scope.log = function(){
        playerFactory.log(function(){
          console.log("controller");
        })
      }
    }]);


    myApp.controller('teamsController', ['$scope', '$location', 'teamFactory', function ($scope, $location, teamFactory) {
      console.log("$location: ", $location);
      $scope.teams = []; 
      $scope.newteam = {
        name: ''
      };
      teamFactory.getTeams(function(data){
        $scope.teams = data; 
      }); 
      
      $scope.addteam = function(){
        teamFactory.addTeam($scope.newteam, function(){
          $scope.teams.push($scope.newteam);
          // $location.url('/teams');
        })
      }

      $scope.removeteam = function(index){
        teamFactory.removeTeam(index, function(){
          $scope.teams.splice(index, 1);
        })
      }

      $scope.log = function(){
        teamFactory.log(function(){
          console.log("controller");
        })
      }
    }]);



    myApp.controller('associationsController', ['$scope', 'playerFactory', 'teamFactory', function ($scope, playerFactory, teamFactory) {
      $scope.players = [];       
      $scope.teams = [];       
      $scope.assignment = {};
      playerFactory.getPlayers(function(data){
        $scope.players = data; 
        $scope.assignment.playerindex = 0; 
      }); 
      teamFactory.getTeams(function(data){
        $scope.teams = data; 
        $scope.assignment.team = data[0].name; 
      }); 

      $scope.assign = function(){
        console.log("assign! ", $scope.assignment.playerindex, $scope.assignment.team);
        playerFactory.assignTeam($scope.assignment.playerindex, $scope.assignment.team, function(data){
          $scope.players[$scope.assignment.playerindex].team = $scope.assignment.team;
        })
      }
    }]);
    </script>
  </head>
  <body>
    <div ng-app='myApp'>
        <a href="#!/players">Players</a> | <a href="#!/teams">Teams</a> | <a href="#!/associations">Associations</a>
        <div ng-view="">
        </div>
    </div>
  </body>
</html>